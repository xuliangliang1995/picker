# 模板方法模式(`Template Method Pattern`)

![](https://picker-oss.oss-cn-beijing.aliyuncs.com/20200210/87cd7a6a9c080fb2495f963edb174c72.png_target)

模板方法模式是类的行为模式。是基于继承来实现代码复用的基本技术。

准备一个抽象类，将部分逻辑以具体方法以及具体构造子的形式实现，然后声明一些抽象方法类迫使子类实现剩余的逻辑。不同的子类可以以不同的方式实现这些抽象方法，从而对剩余的逻辑有不同的实现。这就是模板方法模式的用意。

请认真读下面一段话：

`主要关注基本方法和模板方法的定义`

模板方法模式需要开发抽象类和具体子类的设计师之间的协作。一个设计师负责给出一个算法的轮廓和骨架，另一些设计师负责给出这个算法的各个逻辑步骤。代表这些具体逻辑步骤的方法称做基本方法（`primitive method`）。而将这些基本方法汇总起来的方法叫做模板方法（`template method`）。模板方法所代表的行为称为顶级行为，其逻辑称为顶级逻辑。

## 模板方法的结构

![image.png](https://picker-oss.oss-cn-beijing.aliyuncs.com/20200212/000cb32f70bb7d186ad4b9cb15cc3645.png_target)

这里涉及到两个角色：

1. 抽象模板角色：`AbstractTemplate`

   * 定义了一个或多个抽象操作，以便让子类实现。这些抽象操作叫做基本操作，它们是一个顶级逻辑的组成步骤。
   * 定义并实现了一个模板方法。这个模板方法一般是一个具体方法，它给出了一个顶级逻辑的骨架，而逻辑的组成步骤在相应的抽象操作中，推迟到子类实现。顶级逻辑也有可能调用一些具体方法。

   上图 `AbstractTemplate` 中有三个方法：

   （1）`hookMethod()` ：钩子方法。是指提供一个空的默认实现。子类可以选择性地覆盖或不覆盖。

   ```java
   protected void hookMethod() {
     // do nothing
   }
   ```

   （2）`abstractMethod()`：抽象方法。强制子类必须实现的方法。通常表示不可缺少的步骤。

   ```java
   private abstract void abstractMethod();
   ```

   钩子方法与抽象方法，通常用来表示顶层逻辑中的一个步骤。所以属于基本方法。

   （3）`concreteMethod()`：具体方法。如果该具体方法是这些基本方法的汇总，那么这个方法呢，就称做模板方法。

   ```java
   public void concreteMethod() {
     hookMethod();
     abstractMethod();
     // 当然，具体方法也可以作为基本方法。
     otherConcreteMethod();
   }
   final void otherConcreteMethod() {
     // do something
   }
   ```

   所以，模板方法指的是将一个或多个基本方法汇总起来的方法。即上图中的 `concreteMethod()`。而不是`hookMethod()`，也不是`abstractMethod()`。

2. 具体模板角色：`ConcreteTemplate`

   * 实现父类所定义的一个或多个抽象方法，它们是一个顶级逻辑的组成步骤。

     

## 基本方法的分类

1. 抽象方法 `Abstract Method`
2. 钩子方法 `Hook Method`
3. 具体方法 `Concrete Method`

以上概念都比较简单，便不多做阐述。值得一提的是钩子方法的**命名规则**：

钩子方法的名字应当以 `do` 开始，这是熟悉设计模式的 Java 程序员的标准做法。例如：`doSomething()`，`doOtherSomething()`。



## 把大象放进冰箱里

如何把一只大象放进冰箱里？通常我们会得到这样一个答案：

1. 打开冰箱门；
2. 把大象塞进冰箱；
3. 关上冰箱门。

这个答案看似荒唐，但其实也并不是完全没有道理。在一笑置之的同时，我们也应该学会这个逐步拆分的思维方式。

中国有个成语叫 “纲举目张”。纲呢，指渔网上的总绳。目呢，指渔网的网眼。提起大绳子来，一个个网眼就都张开了。寓意下从上，小从大。做事情呢，抓住主要环节，就能够带动次要环节。后来，也用来形容一篇文章的条理分明。

再回到上面的问题。上述三个步骤呢，就相当于我们分析问题的大纲。同时，也对应了我们上面提到的顶层逻辑。上述三个步骤就对应模板方法模式里面的基本方法。将这三个步骤汇总起来，就是模板方法：

```java
public void 把大象放进冰箱 {
  打开冰箱门();
  把大象塞进冰箱();
  关闭冰箱门();
}
final void 打开冰箱门() {}
final void 关闭冰箱门() {}
// 至于如何把大象塞进冰箱，交给子类去实现。
private abstract void 把大象塞进冰箱();
```



## 模板方法的使用场景

模板方法模式，是利用继承的手段来进行代码复用的一种方式。

如果一个流程基本步骤是固定的。而其中存在部分步骤是可变的，不固定的，我们就可以使用模板方法模式。

一来既实现了对不变部分的代码复用。二来也固定了步骤的顺序，避免了一部分错误的产生。而且也符合 “开-闭” 原则 `OCP`。